<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>tamayoke2</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
  <style>
    html,body{height:100%;margin:0;background:#0a0f1f;color:#fff;font-family:"Noto Sans JP",sans-serif;}
    #stage{position:relative;height:100vh;display:flex;align-items:center;justify-content:center;}
    canvas#g{image-rendering:pixelated;box-shadow:0 0 0 1px #223;}
    .leaderboard{
      position:absolute;top:12px;right:12px;width:240px;height:220px;padding:8px;
      border:1px solid #334;background:rgba(0,0,0,.35);
      font:14px "Orbitron",monospace;white-space:pre;overflow:auto;
    }
    .brand{position:fixed;left:12px;bottom:12px;font:12px monospace;color:#9cf;}
    #diag{
      position:fixed;left:12px;top:12px;z-index:9;background:rgba(0,0,0,.6);
      border:1px solid #345;padding:6px 8px;font:12px/1.4 monospace;
      white-space:pre-wrap;max-width:60vw;max-height:70vh;overflow:auto;
    }
  </style>
</head>
<body>
  <div id="stage">
    <canvas id="g" width="960" height="540"></canvas>
    <pre id="ui-leaderboard" class="leaderboard">未設定</pre>
  </div>
  <div id="diag">boot…</div>
  <div class="brand">tamayoke2</div>

  <!-- ★インライン・ブート（どのJSが失敗しているか可視化＆main起動） -->
  <script type="module">
    const V = "probe-20250825-4";  // ←キャッシュ破り。更新して保存
    window.V = V;

    const diag = document.getElementById("diag");
    const files = [
      `./js/main.js?v=${encodeURIComponent(V)}`,
      `./js/rank.js?v=${encodeURIComponent(V)}`,
      `./js/bullets.js?v=${encodeURIComponent(V)}`,
      `./js/spawner.js?v=${encodeURIComponent(V)}`
    ];
    const log = (s)=> diag.textContent += `\n${s}`;

    async function probe(url){
      try{
        const r = await fetch(url, { cache:"no-store" });
        const ct = r.headers.get("content-type") || "";
        if(!r.ok){ log(`❌ ${url} -> HTTP ${r.status}`); return; }
        const txt = await r.text();
        log(`✅ ${url} -> 200 (${ct}) len=${txt.length}`);
      }catch(e){
        log(`❌ ${url} -> ${e.message}`);
      }
    }

    // 1) 各JSがHTTP的に読めるかチェック
    for(const f of files){ /* eslint-disable no-await-in-loop */ await probe(f); }

    // 2) main.js を import（依存でSyntaxError/404があるとここで落ちる）
    try{
      await import(`./js/main.js?v=${encodeURIComponent(V)}`);
      log("🚀 main.js imported. 起動しました。");
    }catch(e){
      log("💥 import(main.js) 失敗");
      log(String(e && (e.stack || e.message || e)));
      log("→ 上の ❌ を直してください。（ファイル未追加/貼り間違い/構文エラー）");
    }
  </script>
</body>
</html>
